class ProfilesController < ApplicationController
  def index


    ############################################
    #Date filters 
    
     
     #end date
     if(params[:selected_end_date] == nil || params[:selected_end_date] == '')
    	  end_date = Date.civil(3000,1,1).to_s(:db)
     else
        @current_selected_end_date = FilterUtils.handle_textfield_memory(params[:selected_end_date])
        end_date = TimeUtils.parse_european_date(params[:selected_end_date])
     end

     #start date
    if(params[:selected_start_date] == nil || params[:selected_start_date] == '')
    	 start_date = Date.civil(1000,1,1).to_s(:db)
    else
      @current_selected_start_date = FilterUtils.handle_textfield_memory(params[:selected_start_date])
      start_date = TimeUtils.parse_european_date(params[:selected_start_date])
      
      result = Array.new
      errors = Array.new
      errors += FilterUtils.perform_start_end_date_validation(params)
      if errors.size > 0
          flash[:notice] = FilterUtils.format_errors(errors)
          return
      end
    end






    ############################################
    #Average daily profile
    
    #sql statment:  "select stddev(electricity_value)+avg(electricity_value) as upper, avg(electricity_value) as avg,avg(electricity_value)-stddev(electricity_value) as lower, extract(min from end_time) as M, extract(hour from end_time) as H from electricity_readings where extract(dow from end_time) in (1,2,3,4,5) group by H,M order by H,M;"
    
    axis = ElectricityReading.all(:select => "extract (hour from end_time) as H, extract (min from end_time) as M", :conditions => " start_time >= '#{start_date}' AND end_time <= '#{end_date}' ", :group =>"H,M", :order => "H,M") 
    
    select_string = "stddev(electricity_value)+avg(electricity_value) as upper, avg(electricity_value) as avg,avg(electricity_value)-stddev(electricity_value) as lower, extract(min from end_time) as M, extract(hour from end_time) as H "
    where_string = " start_time >= '#{start_date}' AND end_time <= '#{end_date}' AND  extract(dow from end_time) in (1,2,3,4,5)"
    
    readings = ElectricityReading.all(:select => select_string, :conditions => where_string, :group => "H,M", :order => "H,M")

    lower = "daily_lower = [ "
    avg = "daily_avg = [ "
    upper = "daily_upper = [ "
    time = "daily_time = [ "
    
    axis.each{ |x|
      time = time + "\'#{x.h.to_s.rjust(2,"0")}:#{x.m.to_s.rjust(2,"0")}\',"  
    }
    
    readings.each{ |x|
      lower = lower + "#{x.lower},"
      avg = avg + "#{x.avg},"
      upper = upper + "#{x.upper}," 
    }
    
    @daily_time = time[0...-1] + "]"
    @daily_lower = lower[0...-1] + "]"
    @daily_avg = avg[0...-1] + "]"
    @daily_upper = upper[0...-1] + "]"
    
    
    ############################################
    #Average weekly profile
    
    #sql: "select stddev(electricity_value)+avg(electricity_value) as upper, avg(electricity_value) as avg,avg(electricity_value)-stddev(electricity_value) as lower, extract (dow from end_time) as D, extract(min from end_time) as M, extract(hour from end_time) as H from electricity_readings group by D,H,M order by D,H,M;"
    
    axis = ElectricityReading.all(:select => "extract (dow from end_time) as D, extract (hour from end_time) as H, extract (min from end_time) as M", :conditions => " start_time >= '#{start_date}' AND end_time <= '#{end_date}' ", :group =>"D,H,M", :order => "D,H,M") 
    
    select_string = "stddev(electricity_value)+avg(electricity_value) as upper, avg(electricity_value) as avg, avg(electricity_value)-stddev(electricity_value) as lower, extract (dow from end_time) as D, extract(min from end_time) as M, extract(hour from end_time) as H "
    where_string = " start_time >= '#{start_date}' AND end_time <= '#{end_date}'"
    readings = ElectricityReading.all(:select => select_string, :conditions => where_string, :group => "D,H,M", :order => "D,H,M")

    lower = "weekly_lower = [ "
    avg = "weekly_avg = [ "
    upper = "weekly_upper = [ "
    time = "weekly_time = [ "
    
    dow = FilterUtils.get_abv_days_of_week_hash
    axis.each{ |x|
      time = time + "\'#{dow[x.d.to_i].first} #{x.h.to_s.rjust(2,"0")}:#{x.m.to_s.rjust(2,"0")}\',"  
    }
    
    readings.each{ |x|
      lower = lower + "#{x.lower},"
      avg = avg + "#{x.avg},"
      upper = upper + "#{x.upper}," 
    }
    @weekly_time = time[0...-1] + "]"
    @weekly_lower = lower[0...-1] + "]"
    @weekly_avg = avg[0...-1] + "]"
    @weekly_upper = upper[0...-1] + "]"
 #   @weekly_time = time[0...-1] + "]"
   
  #  @weekly_lower = "weekly_lower = [ 37.33477594438532596156876975176995,38.99629177646685745527927193199249,37.09634888033379135242412345702610,38.77384432174821936434574500996588,38.03207487647121693638336773202830,37.41328049336866406545431988274420,39.03250164630170138734555366691012,39.13242760500545920418813904466733,38.47398081574916617304067313143842,39.04448254123849966199484640133948,39.43838278186398056141953841857158,39.26705985760548350681736845974152,41.13004559125742844122011563724062,40.40582297600440373048824094098959,42.45498931745762620294530629050284,43.42380490234267018507332800324960,42.65723922793377994848345579909724,44.33613219720324383050298921657527,44.51286612171289371400381408601319,43.72498405874928828690556727798559,43.64931697785855446103504826874141,44.49624909756750957754571333136943,45.25534092295757638016542671379343,45.44048345939155801313353194245477,46.75888566016917584390558571893362,44.81157074041675455378382503052289,44.14390373278004288817092853282522,45.60911732071721460858268822951076,45.23360274200541243355987409350865,45.32598988909580827098920259913323,44.41827386855631149057323191740428,42.67603786364790176406952007647243,42.98749588131593829861364028141989,42.20486052523303921965084286430933,40.98381687183765715719361473195630,41.87919391835906085031191352170690,38.92953305559269326742445293043350,40.97035182800803896061720678855439,40.92705191340057513087959676077254,40.83427230190131437791045910823167,40.46844684324135512126460132506658,39.25087516699504863192346690043407,39.15146279512971551416191569028183,38.39220997543573675674870898917959,39.11783584108875533281921222107577,38.13753259670142476124334559092205,38.36083300919235618994391635085029,38.58877481773137108249417636673278,37.95330817096634106763482389365250,37.85998732384968387277004864613224,49.42439097394576919981812670911438,39.73205138985623922977766350313968,37.94234612686051470569576253151501,38.11769323150843159730143394418163,38.45714054392625261077544054596043,38.49010337604605298121667576726112,38.39423394232217426305006553310316,38.46864520487080618680269188446462,38.68717870946619037865210989547092,38.55467518863548653825913242376294,39.08927152481689987605103496214497,37.48236811917850399976744407242595,36.02910670964090072718706422302636,35.10548420584333370614613739536027,32.29987318565425710451581705510790,29.13948354124559098613880796959441,27.84440332851015763091583645617721,29.01976868358737430861006601700846,29.50395531280883650720397965444963,29.55551514386768574052667630409247,31.66768630128968318035062181249024,31.03732580041182604509534137301290,31.21254141540119074320421446916183,31.74687604668634813856796796123819,30.12872743634018258927260056467678,29.94564379081415251571767212597255,30.62543345193282153267258544673073,31.55792493160590629555278024161880,31.91321844133660299377944728056881,32.22897690438814714872956551277779,32.10391263604922947961322520796576,32.35726458410490061156104218717250,32.26277273016981642531699533141917,34.22970075806931219563507955782632,35.70274556123902440103370009482903,34.91685724032135595115155910968562,36.45949128492262957675403030256517,37.04590979016294779748799148619335,36.57809351741370863498843417907126,37.29856207298252941148474814994950,37.56785812306972725875419503391564,37.90762742467918670166595278904746,37.66305365427157228222084841331032,37.73774627569570120851354320342789,37.84613428758822110088606746647669,37.90931303788093400220471863410689,36.88347466080460996352868997255837,37.98080554214407589004609045543672,44.37602308567786948930991115541035,38.87342437864937517571358344688048,34.58862539337296990916931894631905,34.26196921134827565155500870982902,38.14372319468730734264987812146861,37.90013821865105779207138794336502,37.27831846736565649720013539983160,38.05392544223346360670798828255360,37.79880430014505695340654415144103,38.22073037292204882238204725470949,39.16206813718805264304809491825029,37.61343147347246715508461950322595,36.73265441412376313075729353453323,37.58925901260993161948040282251458,35.99121390597643143389934904871118,34.55421569342177135349266686817259,33.09983593542223433730520000667252,32.79576640631127938428893177444455,33.39771738155920268343193403103215,35.24940602343991698861809521895937,34.79735029421371976703436334085508,34.42324218649523720655709650481295,36.32774639591921538067152846435576,35.43674325720998780007944796983052,35.64931461132638573015138120236711,36.55467967696766112518711374225773,35.97157512005132038757829691114116,35.77069635414047338065008345583288,35.04734450723478359070306560738495,34.88992781315740116980106775436700,35.38843750410108656813278326793458,35.94377428195244810446273313029204,36.49669172245313933174263230274217,37.68385266186085559816751543831159,37.76179710126555717587388277010151,38.02583561165557502573286424940437,38.04951583272056455497046284735395,38.30078235643009495499482130006301,38.10834185071362609231520741839843,38.24803117568252169474036459841427,38.32366890381120648453400672999530,38.86824033936971464523138886320405,38.89234949475600156665793682499714,37.79408565799585105009761375849712,38.44713415334927992929197107831162,38.70938278700781478840298516505250,38.66092019232383369748834276434511,38.41517592147746864283579763252980,43.67206570893007567934106513982675,40.11318596018983061379992128545135,38.29945586114645277921672684019800,38.60084423275766470854399765512816,38.17817033882259779371173195463911,38.74427246732211663510714054762451,38.89644967367781214089604821915991,38.13442990867852936831934762115512,37.86664158263408446656990179341374,38.72559836647281077086025808786437,40.65022085200951167703902914664962,39.86199241633320057399690554773844,42.50833327370283831254815395121060,44.31113958088079914596355472496077,45.05292075638451950481659044859898,48.81853752041580389433603616604366,49.24133952243638528460183458857759,47.76941461924646096779422802307951,47.72302953610136981633493342891790,48.36802261011171233596004007890159,47.83547870030661108854040479930724,47.98632825702653345349937775470406,47.15493818765651942792302091070502,47.94268684832576669739116157780124,47.82172800239037390764078444948711,47.35643296975969319145253975467827,47.73252000284944138186227299179471,46.97498594042910104286233409145789,47.30547226093813376942170046075012,47.37044612697493339470742545480494,46.89083378202090453462368296555044,45.61901269489951660375372678085928,44.65961675537570674873499484056882,42.62789955562951969316317130627388,41.93697883627655224433451614117958,40.96524966858264724729730570464496,40.93126419104789495217519519752294,39.66583714878570033319175551495600,39.98530609922072431204569816977878,39.88553019077389168523606335334399,38.52675236413072145867153591087301,37.09604068570354612446455949075350,38.72316918530888925487936721372278,38.16083593230526503073394986700171,37.49324856569349035786576396390977,37.75947343495586793458385946702088,38.48397558324048846546343900810044,39.06559800395857918350250630184761,50.60539406399167641746529224531577,39.30008734717189593405915476009230,38.23766078666593242674681113864938,38.33547386291508831316926256962275,38.39769225021023867028145462417061,38.56788172859862227076601031796684,38.30629602515388807915843843644649,38.27367406453168272150532710778599,37.89065418448020141588089252320092,39.49521587523207697902886251094720,45.51400991563266304300369508583258,45.92422338031712369391616563078141,58.29222982939145486672194600466253,65.46945448648468303495393414829970,76.31999195274897921841820410644293,93.62664434778813554967946769408415,99.27522091602243065747342511588946,91.47009459485469960564362631742234,92.15653769764064633729310392075401,91.29202997927165594066635599581662,91.31313259203909921185958188423689,90.64001736882542604247556209293964,90.49127357158859270591625068155874,88.45555112403839539819333262858316,92.25496945367793422107557055995579,91.20534439501899116202600689054833,89.65483585449059103724839019793808,86.78655233800864254799817946571550,85.94547376667057141714390234901170,87.05253364752461153101592529391994,84.48859729947370707129109219405251,75.92929837300206819799084222442220,71.04273200959278762435232733036073,64.76695669496873833577863330049990,60.17953475105338271085435517918367,56.60187248578249647693137989129028,52.00511831970871587156900619499221,48.49196930531758249561421591126527,45.99724025388816717454901118111563,44.65423568710245956791117119081561,42.04035692025409506994300745740099,40.39165867458601685848404594456309,38.96404309171609792365715205388083,38.98265978511188490516152101115047,39.35427296383745682313055858175975,39.25651209443985247580540658225785,39.36085899247868848616277670489186,40.58775966554720527443868166123469,38.41195945608935100596497791137794,40.21970211228246444577109041600803,39.14935097328445655058345221205072,39.67502491152079427679489993930842,39.79909912873731431383137872386021,40.75454626484528925273264475719042,40.10909045135293936886870438583582,39.54255047323529211630213726820962,40.18244832158394452972475251036892,40.98673224703970495409767126422060,46.85733509381994650401060524278704,48.18778447819910505624831993344528,61.13155569457347292569724930039444,67.47524399667945026393646564579062,78.48592531731228954966288835183178,98.72542886406711902192363835728819,106.41647607946317015064575844605360,99.61095759331930097333454276487169,98.62377203713929134286358091549548,95.41633101606799107827697830453566,95.99090950646671643614012297832756,97.37354082013499691402886047442896,94.14400611922679838034271171116145,93.36947379093676580033443685676264,96.69758253996656689032528439859138,96.39598321056532730319545119547492,92.91066599134955861441266548040549,91.87544126408447467575179308884124,92.45488523271214608398630943555812,91.43204256615050373902474618736338,91.21447364391254414467380238021207,84.80505968824316629450600540902226,74.42692233021530494948163160942493,70.10613418948635272486503121105185,63.81490294059375331924999445375199,59.18655321183127812539411814118417,54.46727438997726106101719911407489,50.14284275832904258279649494038775,47.13900198024324266194357116543778,44.99911899122582936137635127893976,42.75177721522247003403253524789191,39.29597173220594397761551935068415,40.14996566922112580218819765554144,39.70755449207163235215728653855274,39.09961726366573989000140686958401,39.31220348882081844280905400455960,39.37698325552332395726319767785860,40.87659475871179971545998228763944,50.22971184015765639608480223576318,41.08429349359012669026476225545501,39.64260189810578240554427786262266,39.75338252929251958252797713441934,40.39431763283135235315285530485428,40.60471329738765961286762819053820,40.75348097228139203900130034089965,40.03332888969601951166103128182362,40.32963618259525101226482696648082,40.90358861300303602776433176685739,46.16630637459220227084415788262972,48.25885026997837022242100268011073,61.03595260493849127485077275559183,65.08613416185995167056693669661866,75.21127581857749262871255862349945,93.97804376194983231837361647557432,96.90878840201343114716774617480229,93.14665984121215048897474804914537,90.63788348654545424903470798940449,90.79695061164062531182005273738926,89.14121256251968387836790885542914,88.47992041946618726972704216128506,89.51924441853738248289109139451366,86.84591676373928109335750111505018,90.75537458349717041069097866331052,89.91136630477389442561548868064213,88.90307010577620445607491374096122,84.14048598573806316883945659606640,83.58647740315678601527569524374899,83.26286460066347305432287856202863,80.08553704791934058616794094909339,75.98860759379618617886746639079993,70.01505964856035362380346752496033,64.16103703458390302893944154452328,57.32210570752066822531681819722541,53.95729392729275923081842433619257,50.38939650534341590032004173110300,47.19703805797420866457387316525603,44.35337962118345488058614590417842,43.20649448714473825381824430046505,41.18837544689462789829333134918566,38.70890450609665060951792156435790,37.74331316282566123892305031516096,38.71498067716027678616524316595682,38.63532302066213608571492864519962,37.96668293911448997261998059074521]"#lower[0...-1] + "]"
  #  @weekly_avg = "weekly_avg = [ 0.00000000000000000000,0.15000000000000550000,0.10000000000002250000,0.09999999999999425000,0.09999999999996575000,0.09999999999999425000,0.10000000000002250000,0.15000000000001975000,0.09999999999999425000,0.14999999999996300000,0.09999999999999425000,0.20000000000004550000,2.2999999999999550,1.3000000000000100,1.5500000000000400,1.24999999999998475000,1.14999999999996225000,0.65000000000004825000,1.09999999999999450000,1.5500000000000118,1.8500000000000085,0.89999999999999025000,0.65000000000000625000,0.44999999999997475000,0.55000000000001050000,0.59999999999996600000,0.59999999999999500000,1.2500000000000158,1.09999999999998025000,0.95000000000001625000,1.15000000000002025000,1.3000000000000250,2.0999999999999383,2.2999999999999960,2.0500000000000418,1.4499999999999580,2.3999999999999910,2.2000000000000348,1.4999999999999848,1.4500000000000475,2.1000000000000098,1.2999999999999550,1.2500000000000000,1.14999999999997500000,1.20000000000001750000,0.25000000000005675000,0.19999999999996025000,0.15000000000003400000,0.00000000000000000000,0.20000000000001700000,0.10000000000002250000,0.09999999999999425000,0.09999999999996575000,0.09999999999999425000,0.10000000000002250000,0.10000000000002250000,0.09999999999999425000,0.04999999999995450000,0.20000000000001675000,0.20000000000004525000,2.5000000000000025,1.4999999999999725,1.6999999999999900,1.2999999999999973,1.15000000000004975000,0.59999999999996575000,0.74999999999998525000,1.6500000000000043,2.6500000000000608,0.54999999999992625000,0.50000000000001450000,0.50000000000000050000,0.50000000000002950000,0.50000000000000000000,0.39999999999997725000,0.70000000000004625000,0.54999999999994025000,0.40000000000003400000,0.34999999999999425000,0.54999999999996875000,0.95000000000000400000,1.00000000000005775000,0.84999999999996650000,0.80000000000001150000,1.5999999999999793,1.7500000000000148,2.2999999999999673,1.7500000000000575,1.19999999999998625000,1.14999999999997500000,2.3500000000000225,1.3999999999999775,1.3500000000000225,0.59999999999996475000,0.90000000000003400000,0.44999999999995950000,0.00000000000000000000,0.10000000000002250000,0.15000000000000550000,0.10000000000002250000,0.09999999999993750000,0.10000000000002250000,0.10000000000002250000,0.14999999999999150000,0.15000000000000550000,0.09999999999996575000,0.10000000000002250000,0.29999999999998300000,2.1500000000000050,1.3499999999999950,1.9499999999999900,1.7500000000000423,1.24999999999997250000,0.69999999999997400000,0.79999999999999725000,1.15000000000003375000,1.6500000000000223,0.45000000000000325000,0.64999999999997750000,0.75000000000001500000,0.50000000000001375000,0.94999999999999000000,0.80000000000001075000,0.94999999999999000000,1.3999999999999918,0.65000000000000500000,0.64999999999999250000,0.75000000000001375000,0.60000000000000750000,0.79999999999996975000,0.54999999999999750000,0.60000000000002200000,0.74999999999995800000,0.60000000000002275000,1.05000000000002550000,1.4499999999999595,1.8000000000000260,1.4000000000000070,1.4500000000000175,1.09999999999999500000,1.14999999999997575000,0.20000000000001700000,0.20000000000001700000,0.19999999999996025000,0.00000000000000000000,0.05000000000001125000,0.15000000000003400000,0.09999999999999425000,0.09999999999996575000,0.15000000000000575000,0.05000000000001125000,0.20000000000004500000,0.39999999999997700000,0.00000000000000000000,0.19999999999993200000,0.80000000000006800000,2.6000000000000200,2.0000000000000000,3.3999999999999800,1.79999999999995000000,1.80000000000007000000,1.00000000000000000000,2.0000000000000000,2.0000000000000000,3.0000000000000000,0.59999999999990900000,0.40000000000009100000,0.39999999999997700000,0.60000000000002300000,0.59999999999990900000,0.40000000000009100000,1.00000000000000000000,0.59999999999990900000,0.00000000000000000000,0.00000000000000000000,0.20000000000004500000,0.79999999999995500000,1.00000000000000000000,1.00000000000000000000,0.80000000000006800000,1.39999999999998000000,1.20000000000005000000,2.1999999999999300,2.6000000000000200,3.3999999999999800,2.8000000000000700,3.0000000000000000,1.79999999999995000000,1.60000000000002000000,0.60000000000002300000,0.19999999999993200000,0.39999999999997700000,0.00000000000000000000,0.20000000000004500000,0.19999999999993200000,0.20000000000004500000,0.19999999999993200000,0.20000000000004500000,0.20000000000004500000,0.19999999999993200000,0.20000000000004500000,0.19999999999993200000,0.20000000000004500000,0.60000000000002300000,3.0000000000000000,1.79999999999995000000,2.0000000000000000,1.80000000000007000000,2.1999999999999300,1.00000000000000000000,2.0000000000000000,1.60000000000002000000,2.2000000000000500,1.00000000000000000000,0.79999999999995500000,0.60000000000002300000,0.39999999999997700000,0.79999999999995500000,0.40000000000009100000,1.00000000000000000000,0.79999999999995500000,0.20000000000004500000,0.39999999999997700000,0.19999999999993200000,0.40000000000009100000,0.59999999999990900000,0.40000000000009100000,0.39999999999997700000,0.39999999999997700000,0.20000000000004500000,0.59999999999990900000,1.20000000000005000000,1.60000000000002000000,1.60000000000002000000,2.1999999999999300,3.2000000000000500,2.0000000000000000,1.00000000000000000000,0.39999999999997700000,0.60000000000002300000,0.00000000000000000000,0.53333333333330333333,0.06666666666668166667,0.20000000000000766667,0.06666666666664400000,0.06666666666668166667,0.06666666666664400000,0.06666666666668166667,0.06666666666668166667,0.13333333333332566667,0.06666666666668166667,0.13333333333332566667,2.0000000000000000,1.13333333333332666667,1.3999999999999933,1.13333333333332633333,1.06666666666668300000,0.53333333333332233333,0.73333333333336866667,1.13333333333328900000,1.8000000000000303,0.53333333333334066667,0.46666666666664066667,0.60000000000000333333,0.53333333333332333333,0.66666666666668466667,0.66666666666666666667,0.86666666666663700000,1.6666666666666833,0.53333333333332200000,0.53333333333337866667,0.39999999999997733333,0.86666666666665400000,0.86666666666665533333,1.26666666666669133333,0.66666666666666666667,1.19999999999998966667,1.26666666666667133333,0.99999999999998100000,0.73333333333336900000,0.93333333333331666667,1.26666666666669000000,1.3333333333333333,0.79999999999999333333,0.73333333333333033333,0.33333333333331466667,0.13333333333336366667,0.19999999999996966667,0.00000000000000000000,0.13333333333330700000,0.06666666666668166667,0.06666666666664400000,0.06666666666668166667,0.06666666666668166667,0.13333333333330700000,0.13333333333332566667,0.06666666666668166667,0.06666666666668166667,0.06666666666664400000,0.13333333333332566667,2.5333333333333600,1.6666666666666667,1.4666666666666400,1.13333333333336300000,1.06666666666664300000,0.66666666666666666667,0.93333333333335500000,1.13333333333332633333,1.5333333333333223,0.66666666666666666667,0.46666666666667666667,0.59999999999998333333,0.66666666666666666667,1.3999999999999757,1.06666666666670166667,0.86666666666665400000,1.06666666666666300000,0.93333333333331666667,0.93333333333333666667,0.73333333333336666667,0.86666666666665666667,0.80000000000001000000,0.86666666666667400000,0.73333333333333000000,0.66666666666664733333,0.66666666666668600000,1.9333333333333167,0.66666666666664766667,0.93333333333333833333,1.3333333333333537,0.93333333333333700000,1.00000000000000000000,0.93333333333333666667,0.20000000000000766667,0.06666666666664400000,0.06666666666668166667]"#avg[0...-1] + "]"
  #  @weekly_upper =  upper[0...-1] + "]"#"weekly_upper = [ 0.00000000000000000000,0.34148542155126702927706193487034,0.21547005383797363366394328925978,0.21547005383791276337373408461933,0.21547005383785135440839030392338,0.21547005383791276337373408461933,0.21547005383797363366394328925978,0.25000000000003291666666667015109,0.21547005383791276337373408461933,0.24999999999993833333333337994778,0.21547005383791276337373408461933,0.43094010767594834467815576814535,3.91245154965962730660383058627125,2.17177978870815082820029961314561,2.77610494385001023657876945209013,2.00498344352703943230306610231142,1.83068592855535185867001282417307,0.90166114784238478468394911318237,2.11324561023798913255344964818685,2.41986589004671164243077925928474,2.97398102000581349126220401063005,1.52182527020588900670186715239814,1.22445626465377299487145034021810,0.97599112793528384517148271449176,1.26879528842827535701952450733537,0.92659863237108417397672275596190,1.18878405775516542838031898033137,1.91080758672000176135084841843554,1.69999999999999341666666666724741,1.94833194212480513976476376570793,2.26205515450748179376851593212869,2.90416125540214281623692436369648,3.76933120340645313312468391513932,4.71384893203085383608026989990491,3.75782512766001828166441859463736,2.52548438699339343747788358488039,4.41990098767238480742673169723167,4.36024689946934036866401785404234,2.63724814061543532645878760609735,2.57398102000591589684058850905249,3.71245154965975154538274477823692,2.38934230922445706036028730720155,2.15000000000001555555555555723594,2.00440037453170275787193900444646,2.04852813742388002900042246463991,0.55000000000012480555555555555560,0.48284271247453636194894576158581,0.34148542155134514140900930673366,0.00000000000000000000,0.36329931618559935714091782634702,0.21547005383797363366394328925978,0.21547005383791276337373408461933,0.21547005383785135440839030392338,0.21547005383791276337373408461933,0.21547005383797363366394328925978,0.21547005383797363366394328925978,0.21547005383791276337373408461933,0.14999999999986350000000000000000,0.36329931618555256683580493938909,0.36329931618562760714091781651514,4.32208671582887489927902403558359,2.61355287256594784823339993161565,3.10949163412438167268747574272560,2.10829037686546598847722365493217,1.83068592855549396045492931872320,0.88284271247459560206431594110096,1.16231056256172272620099087234829,2.63488578017964887088333354633827,4.28605215890780129816163436183866,0.96231056256175394945350438956946,1.02915026221292115317797520461546,1.09999999999998683333333333569796,0.97609522856957579779333805111454,1.50000000000000000000000000000000,0.83204937989382765508031620866498,1.27735026918967311147466024815015,0.74148542155124625611815862124293,0.83204937989388440508031620373932,0.79347115652166586734699763933856,0.89156502553195824167924982951602,1.14148542155130225966246858663058,1.36514837167018967091020338877734,1.29347115652165213554541989111829,1.03094010767584852674746815080819,2.91656117720870767025145666347556,3.23211560502774599543506560053953,4.27652894404976139263439230855393,3.28514385862270951585176275772219,1.96594168620501104259539315841432,2.00440037453170275787193900444646,4.33913716637812700419612665975686,2.49544511501028964375349771174199,2.42548438699349702064249449992751,1.44852813742379820905497368375565,2.32828568570859447769530857339377,1.22244201508375356208653208582915,0.00000000000000000000,0.21547005383797363366394328925978,0.25000000000000916666666668085443,0.21547005383797363366394328925978,0.21547005383779048411818106225888,0.21547005383797363366394328925978,0.21547005383797363366394328925978,0.24999999999998583333333334397444,0.34148542155126702927706193487034,0.21547005383785135440839030392338,0.21547005383797363366394328925978,0.68297084310249665836070225801607,3.64108461642302454685125253815523,2.29339811320565502779943936902854,3.57788205960997742946849505357514,3.26767365837764754574867056888831,2.16469484893413061414993449137304,1.17609522856948151003501047164706,1.20000000000000275000000000000000,1.83068592855541371153850740041870,2.75000000000006440606060606260939,1.02445626465380376593670574506650,1.40498344352702884889663415443353,1.65000000000002722222222222245405,1.37177978870814826926761817156544,2.12046999107194168904654541512434,2.03288280059381452963774431956422,2.12046999107194168904654541512434,2.79522996909708694262062098891111,1.95000000000001500000000000000000,1.94999999999997750000000000000000,2.11991483920231388447296047188149,1.80000000000002250000000000000000,2.01106014163895909475997503601136,1.64999999999999250000000000000000,1.27330032922416597603571210280682,1.52244201508370368736592264583788,0.88284271247462573200663085359375,1.64721576223893811257679328225103,2.76021626713546226136014892730483,3.37480157480245818100698399523096,2.61106014163897371995460168857672,2.63180652674909033234907855484074,2.00184995056459160113889456541472,2.21301458127338467087219994964792,0.48284271247464685206431593918661,0.48284271247464685206431593918661,0.43094010767576465645725894156012,0.00000000000000000000,0.15000000000003375000000000000000,0.34148542155134514140900930673366,0.21547005383791276337373408461933,0.21547005383785135440839030392338,0.34148542155130705602144781796024,0.15000000000003375000000000000000,0.20000000000004500000,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0.00000000000000000000,1.45709376403665259502041098248432,0.18213672050463280033394328925978,0.20000000000003999828507461904276096320053046,0.18213672050452989308352486154840,0.18213672050463280033394328925978,0.18213672050452989308352486154840,0.18213672050463280033394328925978,0.18213672050463280033394328925978,0.24880338717124418004373408922693,0.18213672050463280033394328925978,0.36427344100916269341746815080819,3.83303027798234254917192595736006,2.15965362122270089678741240136686,2.79999999999996830000000000036012,2.03518328389791051555154252742131,1.87495704353219589701212160290072,0.83883837966370053799013444565966,1.23665562901808537937906350749595,1.77624338406612897203777748039300,2.67177978870818737848144877785177,0.76427344100919414790014005690105,1.10957671739951273236272938726701,1.63923048454133548294915970116117,1.45709376403670723603656236003019,1.47495704353216246903361586206501,1.82136720504591819568829756100391,1.17217171299704062704434693727275,1.78213672050460267939913785984273,0.94966653322655663352822669837662,0.76427344100919923893479624823248,0.59999999999996583333000000000020,1.36998896235140018355400820488314,1.85324323912991396004376684835143,2.02385444610672640606086161189355,0.97217171299704487133013444565966,2.23923048454130767120756455572073,2.25324323912989894369809831192960,1.87177978870813142542516653028388,1.14966653322660627564276448231707,1.83518328389787150180708563101693,2.68558644358624533144288372393330,2.86085856498527996886268239790934,1.52111025509278287145090087510171,1.43571025019017062034703378312970,0.74966653322651775495192709613095,0.36427344100926651134815576814535,0.54641016151369258650099301235660,0.00000000000000000000,0.24880338717120934756619676939984,0.18213672050463280033394328925978,0.18213672050452989308352486154840,0.18213672050463280033394328925978,0.18213672050463280033394328925978,0.24880338717120934756619676939984,0.36427344100916269341746815080819,0.18213672050463280033394328925978,0.18213672050463280033394328925978,0.18213672050452989308352486154840,0.36427344100916269341746815080819,4.76343049115708196329116005291866,3.19419189831861336886268239790934,2.87142050038031336043329984703015,1.96599973311985508531837062158104,1.87495704353210146112959800924698,1.08299986655990114007007289327895,1.63571025019019025647965629498880,1.94162371019880586774442343084394,2.55965362122270468221843329492024,1.24401693585629243117914878050195,1.27495704353217005749088398147567,1.63923048454128084193300832361530,1.82136720504591819568829756100391,2.64899959967963652611130652655879,1.87495704353216227224345499930136,1.36998896235140018355400820488314,2.74396608338788241588588415178230,2.54991408706423993978215710411725,2.54991408706429458079830848166312,1.49052111277339843770996289090250,2.36777736655966633388571114053215,2.18564064605512915533003276197763,1.85324323912991370606717166327856,2.00350392555050090841743542084666,1.65324323912991863011961183935969,1.27767675932746772259553626452350,3.54991408706423997311215710411725,0.97217171299705074816962134728518,1.57624338406616700259430491797619,2.99866613290628614924306219987404,1.93997792470276956447209492183849,2.00000000000000000000000000000000,1.76599973311979616590907128639279,0.54641016151379640443168062969375,0.18213672050452989308352486154840,0.18213672050463280033394328925978]"#upper[0...-1] + "]"
   # @weekly_upper =  "weekly_upper = [ 47.31838861257669943843123024823005,46.00120822353314254472072806800751,55.12865111966620864757587654297390,47.37865567825178063565425499003412,45.92042512352878306361663226797170,47.06921950663133593454568011725580,45.95249835369829861265444633308988,46.12757239499454079581186095533267,47.36351918425083382695932686856158,45.84551745876150033800515359866052,47.80411721813601943858046158142842,48.18044014239451649318263154025848,54.35245440874257155877988436275938,58.42917702399559626951175905901041,78.07001068254237379705469370949716,81.86369509765732981492667199675040,96.90276077206622005151654420090276,116.89636780279675616949701078342473,126.86713387828710628599618591398681,121.19001594125071171309443272201441,117.84568302214144553896495173125859,112.89875090243249042245428666863057,113.67215907704242361983457328620657,116.63701654060844198686646805754523,114.59611433983082415609441428106638,111.81842925958324544621617496947711,115.78859626721995711182907146717478,113.45588267928278539141731177048924,108.18889725799458756644012590649135,107.82401011090419172901079740086677,108.80672613144368850942676808259572,112.77396213635209823593047992352757,104.14750411868406170138635971858011,98.26763947476696078034915713569067,91.86868312816234284280638526804370,83.95580608164093914968808647829310,81.98546694440730673257554706956650,74.11964817199196103938279321144561,66.21544808659942486912040323922746,61.77072769809868562208954089176833,55.05054049853079667873539867493342,54.06558052920748296807653309956593,49.00043593904749968583808430971817,47.78500521443768104325129101082041,46.07203757663276366718078777892423,45.78651803620996763875665440907795,46.17081256042789701005608364914971,44.62641505568635051750582363326722,45.21124879105897533236517610634750,46.77292406855537932722995135386776,70.72750776023144600018187329088562,47.35655620508046957022233649686032,43.72853994908885229430423746848499,43.88230676849156840269856605581837,44.65678350670665878922455945403957,44.59850421889065581878332423273888,44.94753820957655993694993446689684,44.54401302297729501319730811553538,45.99636559433127802134789010452908,46.50861595060501986174086757623706,51.06262720936031532394896503785503,53.60623947575820480023255592757405,70.02152620175150427281293577697364,73.80590819921995749385386260463973,87.04189896624447709548418294489210,102.25292152204554821386119203040559,106.45939413984427276908416354382279,98.06883891134933449138993398299154,96.52136114288736609279602034555037,98.46980131182851685947332369590753,93.44623774934322821964937818750976,96.68419318692994615490465862698710,94.88872440738361945679578553083817,95.18983281407314546143203203876181,96.65608269024209581072739943532322,98.91511570285673348428232787402745,95.12140199110515306732741455326927,91.55599911902700510444721975838120,88.64374358397985260622055271943119,88.60646613358653645127043448722221,86.60494812344444132038677479203424,84.95919111209763098843895781282750,78.97773359894410757468300466858083,69.56776759636106760436492044217368,61.66434304635591239896629990517097,60.07048453183054284884844089031438,55.21139479102673742324596969743483,52.54902691869781160251200851380665,52.00418496359894956501156582092874,47.73941261056177438851525185005050,46.45745833262647534124580496608436,44.57338523354866149833404721095254,45.37492102927273151777915158668968,44.18630435721569119148645679657211,44.58424545924722189911393253352331,44.01473759503045839779528136589311,46.50114072381077463647131002744163,45.81406625272771890995390954456328,67.36423665458187071069008884458965,48.29540679018179362428641655311952,45.84175435346247309083068105368095,46.77600547219602814844499129017098,43.31781526685115425735012187853139,43.43319511468227560792861205663498,45.31142512237793330279986460016840,43.61274122443320299329201171744640,44.84222134088058404659345584855897,46.01003885784718197761795274529051,52.35075237563246015695190508174971,53.64297878293778924491538049677405,74.29298661151726246924270646546677,82.94920252585160678051959717748542,92.75237583761331216610065095128882,109.03552789632181844650733313182741,118.72067688509058626269479999332748,108.69141308086820781571106822555545,110.21766723382541271656806596896785,103.34033756630367281138190478104063,103.66418816732474183296563665914492,105.16650140324835259344290349518705,104.54404847587565641932847153564424,104.71710289663616599992055203016948,104.09427513226335786984861879763289,105.47096134867336447481288625774227,104.23355308507688481242170308885884,98.15238056893644961934991654416712,101.59368113379085740929693439261505,102.54596962274003463019893224563300,95.84233172666814423186721673206542,86.15878982061165449553726686970796,80.04176981600839906825736769725783,72.95717297916478540183248456168841,66.46897212950367362412611722989849,63.56390797808801477426713575059563,59.02740724420251244502953715264605,56.23767918203144344500517869993699,51.84037609800432270768479258160157,51.05966113200978590525963540158573,47.90710032695802431546599327000470,45.97791350678413155476861113679595,45.15893255652604963334206317500286,47.38540152149132834990238624150288,45.57850687229174567070802892168838,44.13677105914603141159701483494750,44.17024863884499750251165723565489,46.72768122137967415716420236747020,65.34092130405693732065893486017325,47.47122962422575378620007871454865,43.80444024274965102078327315980200,43.71084407893064689145600234487184,45.06858290793064900628826804536089,44.47650675345710416489285945237549,44.45419967697153845910395178084009,45.21621944197082123168065237884488,47.25024153424903233343009820658626,48.72894708807264382913974191213563,54.46666226487360512296097085335038,59.09904654470576042600309445226156,77.54361477824521368745184604878940,86.00054873080751245403644527503923,104.45357275010898689518340955140102,129.38925468737640390566396383395634,130.26515398405712111539816541142241,123.91889706906522743220577197692049,127.88736007428824058366506657108210,121.94366570157659926403995992109841,125.41127454644663571145959520069276,125.07860680790853154650062224529594,119.62428259156425977207697908929498,118.13523522959631130260883842219876,120.28216810150572989235921555051289,124.53967092634420300854746024532173,119.87786960754016901813772700820529,117.62241665697349635713766590854211,114.14907319360732083057829953924988,116.18799543146662500529257454519506,115.26501037382325126537631703444956,108.79657172068489899624627321914072,97.34038324462429325126500515943118,89.08638615865619450683682869372612,80.97211207281435675566548385882042,75.11267240933943075270269429535504,68.39341113362742964782480480247706,63.45104596809741646680824448504400,57.59910948519486008795430183022122,54.55602825078454991476393664665601,53.62909179171343434132846408912699,49.11175152208866167553544050924650,46.57553211339240954512063278627722,46.93007315860382596926605013299829,47.13012805768313304213423603609023,46.73403305855062566541614053297912,46.00320390393899873453656099189956,47.39594045757988241649749369815239,71.29204183344422098253470775468423,50.93068188359733486594084523990770,44.76233921333406757325318886135062,44.81837229093106548683073743037725,46.16641031389232552971854537582939,45.73981057909368532923398968203316,46.51421679535893252084156156355351,45.77760798675036847849467289221401,47.36575607193005498411910747679908,47.81247643246023062097113748905280,57.71675931513656775699630491416742,59.63987918378544050608383436921859,86.22059068342905793327805399533747,89.35105833402813756504606585170030,107.57744394468691818158179589355707,129.16822744708365925032053230591585,144.72477908397756934252657488411054,135.65811053335042859435637368257766,132.40756486646191786270689607924599,126.24643155918988245933364400418338,128.35353407462756738814041811576311,132.20613647732842015752443790706036,127.02154694123192009408374931844126,127.13419246570519440180666737141684,129.77067157196309137892442944004421,130.38439919472459863797399310945167,126.72977953012479356275160980206192,122.34165279019648565200182053428450,121.59298777179096698285609765098830,120.61413301914205506898407470608006,123.61396680309039552870890780594749,110.73736829366459840200915777557780,100.44444747758669957564767266963927,92.30996638195433866422136669950010,85.30764473612610448914564482081633,76.83402495011493932306862010870972,67.35385603926564312843099380500779,61.73879992545164830438578408873473,57.69506743841952522545098881888437,53.75602072315395063208882880918439,50.44682256692539213005699254259901,48.32629004336270114151595405543691,47.62570049802749187634284794611917,47.14554534309324329483847898884953,46.38931677975228677686944141824025,44.76912893120117312419459341774215,44.76734613572643971383722329510814,45.94388590407304792556131833876531,55.43614180973343379403502208862206,47.98282953328715575422890958399197,45.68609206469022704941654778794928,44.50219027835262352320510006069158,46.35279960543990088616862127613979,46.08089677312939434726735524280958,46.19470701700149103113129561416418,46.22960142549888508369786273179038,48.14666560246668847027524748963108,49.19048294283371284590232873577940,56.66165224795220529598939475721296,62.64765855977557854375168006655472,86.23553291302146387430275069960556,91.66399650964966373606353435420938,109.38749240420669785033711164816822,132.79355847770503277807636164271181,142.29238468003050064935424155394640,133.07258671047816742666545723512831,131.62939251982273405713641908450452,126.76088417380542672172302169546434,124.99643226568518236385987702167244,128.90494019252323088597113952557104,125.04586729849472061965728828883855,121.87103253817715819966556314323736,127.98596176383090150967471560140862,128.26224463753593849680454880452508,121.72224540105550458558733451959451,121.33974860933324692424820691115876,120.98815274197139831601369056444188,124.39074224397607846097525381263662,121.95008331811277225532619761978793,116.68861119783278310549399459097774,105.19333083434165705051836839057507,97.81791644342503967513496878894815,93.90661604674801888075000554624801,83.14256071221935487460588185881583,72.77323193913666293898280088592511,66.08500534293678021720350505961225,58.88631447545295993805642883456222,56.97556455307796803862364872106024,52.10898227844841596596746475210809,51.51415485007253702238448064931585,46.71079382444976019781180234445856,46.69750879906760824784271346144726,47.78645868570134870999859313041599,46.53589777700196635719094599544040,46.44580155460325824273680232214140,46.94619005141478248454001771236056,72.32725018515879920391519776423682,49.57393435451113910973523774454499,44.83841076012206579445572213737734,45.15800987577077161747202286558066,46.41580894944712864684714469514572,46.23072974058702398713237180946180,45.90474687581987376099869965910035,46.65021541410144888833896871817638,46.83492077943006538773517303351918,49.12172784269316657223566823314261,57.80837716971159512915584211737028,60.32342821103428797757899731988927,84.48303473683366052514922724440817,87.59741014193751672943306330338134,105.85201532066301377128744137650055,129.51562712412611708162638352442568,140.71146476254353085283225382519771,135.46093509549671031102525195085463,129.23553423497353315096529201059551,127.10178356557456448817994726261074,126.14992667798664532163209114457086,126.91248464382495193027295783871494,125.49341380931071871710890860548634,123.86294399575438970664249888494982,127.42184060637624738930902133668948,128.94939318889699157438451131935787,126.00832229928708674392508625903878,121.30255198894548123116054340393360,118.41352259684321398472430475625101,114.96498350060234974567712143797137,119.45876674954901381383205905090661,112.01139240620381382113253360920007,103.09886440207255777619653247503967,92.97820347174521097106055845547672,82.29814745703629377468318180277459,76.29587062966926616918157566380743,67.25617311490974869967995826889700,60.90422776481060153542612683474397,57.67193683451274771941385409582158,52.00869538627298334618175569953495,49.03947265437119490170666865081434,47.44299422808056459048207843564210,46.48453493844016156107694968483904,44.29767755068782441383475683404318,45.08619596667963611428507135480038,45.45103857987285182738001940925479]"
 # render :text =>  @weekly_upper.inspect and return false

  end

end



